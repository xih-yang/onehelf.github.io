{"version":3,"sources":["kratosr.js"],"names":["kr","window","requestIdleCallback","handler","startTime","Date","now","setTimeout","didTimeout","timeRemaining","Math","max","cancelIdleCallback","id","clearTimeout","copyrightString","docTitle","getTimeString","msec","tString","exact","arguments","length","undefined","sec","dnum","floor","hnum","mnum","snum","dstr","toString","hstr","mstr","sstr","makeDelay","callback","ms","timer","context","this","args","apply","pjaxReload","imageboxs","document","getElementsByClassName","randomAmount","cover","baseUrl","coverFileNameTemplate","filenameTemplate","usedCovers","Array","generateNewCoverID","coverNo","remailFailCounts","random","i","len","$","attr","coverFileName","replace","coverUrl","includes","substring","loadRandomCover","fancybox","defaults","hash","each","find","parent","hasClass","is","alt","after","wrap","src","concat","copyrightNotice","querySelector","getAttribute","title","location","href","MathJax","Hub","Typeset","querySelectorAll","forEach","figure","count","getElementsByTagName","setAttribute","innerHTML","ClipboardJS","on","e","origInner","trigger","clearSelection","runningOnBrowser","isBot","navigator","test","userAgent","supportsIntersectionObserver","commsArea","loadwork","loadCommentsEventHandler","load_comm","observer","IntersectionObserver","entries","isIntersecting","disconnect","threshold","observe","commentsLazyLoad","expire_day","expireAlert","getElementById","dateTimeTag","updateDateTime","parseInt","gap","innerText","classList","remove","expireNotify","tocDOMs","tocItems","from","tocItem","linkItem","titleText","decodeURI","Error","titleElem","push","at","el","console","log","message","add","curTocId","tocActivate","newId","nCur","contains","parentNode","applyDecision","pos","scrollY","requestAnimationFrame","decision","entry","currentIndex","Number","target","boundingClientRect","top","rootBounds","bottom","height","intersectionRatio","rootMargin","x","addEventListener","once","tocUpdatePos","h","getBoundingClientRect","tocGetId","newPos","isInteger","nowY","tocOnScroll","tocOnResize","removeEventListener","readProgBar","articleElem","setPercent","currentTop","documentElement","scrollTop","docHeight","clientHeight","winHeight","headerHeight","offsetTop","contentMath","scrollHeight","scrollPercent","min","scrollPercentRound","round","style","width","tocAnimInit","funcUsingConfig","createTime","upTimeNode","body","oncopy","copiedContent","getSelection","preventDefault","clipboardData","setData","siteLeaveEvent","titleTime","OriginLogo","hidden","leaveTitle","leaveLogo","returnTitle","leaveEventInit","setInterval","layer","open","type","area","donateBtn","resize","scrollbar","content","scanNotice","qr_alipay","qr_wechat","click","removeClass","addClass","topNavScrollToggle","lastHeight","innerHeight","isTopNavHidden","topNavScrollToggleInit","cb","_window$kr","isScrolledDown","pageScrollDownClass","$clone","fetch","siteRoot","then","res","json","cfg","event","animate","offset","clone","prepend","css","w","container","has","next","slideToggle","fadeToggle","onload","dispatchEvent","Event","performance"],"mappings":"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","file":"../js/kratosr.min.js","sourcesContent":["let kr = {};\n\n/**\n * 因为后台任务API还是相当新的，而你的代码可能需要在那些仍不支持此API的浏览器上运行。\n * 你可以把 setTimeout() 用作回调选项来做这样的事。\n * 这个并不是 polyfill ，因为它在功能上并不相同； \n * setTimeout() 并不会让你利用空闲时段，而是使你的代码在情况允许时执行你的代码，\n * 以使我们可以尽可能地避免造成用户体验性能表现延迟的后果。\n */\n// https://developer.mozilla.org/zh-CN/docs/Web/API/Background_Tasks_API \nwindow.requestIdleCallback = window.requestIdleCallback || function(handler) {\n    let startTime = Date.now();\n    return setTimeout(function() {\n      handler({\n        didTimeout: false,\n        timeRemaining: function() {\n          return Math.max(0, 50.0 - (Date.now() - startTime));\n        }\n      });\n    }, 1);\n};\n\nwindow.cancelIdleCallback = window.cancelIdleCallback || function(id) {\n    clearTimeout(id);\n};\n\n(()=>{\n    const loadConfig = (cb) => {\n        // 读取配置文件\n        fetch((window.kr?.siteRoot || '/') + 'config/main.json')\n            .then((res) => {\n                return res.json();\n            })\n            .then((cfg) => {\n                kr = cfg;\n            })\n            .then(()=>{\n                cb();\n            });\n    };\n    const pageScrollDownInit = ()=>{\n        let isScrolledDown = false;\n        const pageScrollDownClass = () => {\n            window.requestAnimationFrame(() => {\n                if (window.scrollY > 200){\n                    if (!isScrolledDown) {\n                        document.body.classList.add('scroll-down');\n                        isScrolledDown = true;\n                    }\n                } else {\n                    if (isScrolledDown) {\n                        document.body.classList.remove('scroll-down');\n                        isScrolledDown = false;\n                    }\n                }\n            });\n        };\n        $('.gotop-box').on('click',function(event){\n            // event.preventDefault();\n            $('html, body').animate({\n                scrollTop:$('html').offset().top\n            },500);\n            return false;\n        });\n        pageScrollDownClass();\n        window.addEventListener('scroll', pageScrollDownClass);\n    };\n    const offcanvas = ()=>{\n        let $clone = $('#kratos-menu-wrap').clone();\n        $clone.attr({\n            'id':'offcanvas-menu'\n        });\n        $clone.find('> ul').attr({\n            'id':''\n        }).addClass('ul-me');\n        $('#kratos-page').prepend($clone);\n        $('.js-kratos-nav-toggle').on('click',()=>{\n            if($('.nav-toggle').hasClass('toon')){\n                $('.nav-toggle').removeClass('toon');\n                $('#offcanvas-menu').css('right','-240px');\n            }else{\n                $('.nav-toggle').addClass('toon');\n                $('#offcanvas-menu').css('right','0px');\n            }\n        });\n        $('#offcanvas-menu').css('height',$(window).height());\n        $('#offcanvas-menu').css('right','-240px');\n        $(window).resize(()=>{\n            const w = $(window);\n            $('#offcanvas-menu').css('height',w.height());\n            if(w.width()>769){\n                if($('.nav-toggle').hasClass('toon')){\n                    $('.nav-toggle').removeClass('toon');\n                    $('#offcanvas-menu').css('right','-240px');\n                }\n            }\n        });\n    };\n    const mobiClick = ()=>{\n        $(document).click((e)=>{\n            const container = $(\"#offcanvas-menu,.js-kratos-nav-toggle\");\n            if (!container.is(e.target) && container.has(e.target).length === 0) {\n                if ($('.nav-toggle').hasClass('toon')) {\n                    $('.nav-toggle').removeClass('toon');\n                    $('#offcanvas-menu').css('right','-240px');\n                }\n            }\n        });\n    };\n    const xControl = ()=>{\n        $(document).on(\"click\",\".xHeading\", function(event){\n            $(this).next().slideToggle(300);\n            if ($(this).parent('.xControl').hasClass('active')) {\n                $(this).parent('.xControl').removeClass('active');\n            } else {\n                $(this).parent('.xControl').addClass('active');\n            }\n            event.preventDefault();\n        });\n    };\n\n    const donateConfig = ()=>{\n        $(document).on(\"click\",\".donate\",()=>{\n            layer.open({\n                type:1,\n                area:['300px', '370px'],\n                title:kr.donateBtn,\n                resize:false,\n                scrollbar:false,\n                content:'<div class=\"donate-box\"><div class=\"meta-pay text-center\"><strong>'+kr.scanNotice+'</strong></div><div class=\"qr-pay text-center\"><img class=\"pay-img\" id=\"alipay_qr\" src=\"'+kr.qr_alipay+'\"><img class=\"pay-img d-none\" id=\"wechat_qr\" src=\"'+kr.qr_wechat+'\"></div><div class=\"choose-pay text-center mt-2\"><input id=\"alipay\" type=\"radio\" name=\"pay-method\" checked><label for=\"alipay\" class=\"pay-button\"><img src=\"/images/alipay.webp\"></label><input id=\"wechatpay\" type=\"radio\" name=\"pay-method\"><label for=\"wechatpay\" class=\"pay-button\"><img src=\"/images/wechat.webp\"></label></div></div>'\n            });\n            $(\".choose-pay input[type='radio']\").click(function(){\n                const id = $(this).attr(\"id\");\n                if (id == 'alipay') {\n                    $(\".qr-pay #alipay_qr\").removeClass('d-none');\n                    $(\".qr-pay #wechat_qr\").addClass('d-none');\n                }\n                if (id == 'wechatpay') {\n                    $(\".qr-pay #alipay_qr\").addClass('d-none');\n                    $(\".qr-pay #wechat_qr\").removeClass('d-none');\n                }\n            });\n        });\n    };\n\n    const shareMenu = ()=>{\n        $(document).on(\"click\",\".share\",()=>{$(\".share-wrap\").fadeToggle(\"slow\");});\n    };\n\n    const loadRandomCover = ()=>{\n        // 图片\n        const imageboxs = document.getElementsByClassName(\"kratos-entry-thumb-new-img\");\n        const randomAmount = kr.cover && kr.cover.randomAmount || 20;\n        const baseUrl = kr.cover && kr.cover.baseUrl || 'https://cdn.jsdelivr.net/npm/hexo-theme-kratos-rebirth@latest/source/images/thumb/'\n        const coverFileNameTemplate = kr.cover && kr.cover.filenameTemplate || \"thumb_{no}.webp\";\n        const usedCovers = new Array(randomAmount + 1);\n\n        const generateNewCoverID = () => {\n            let remailFailCounts = 5; // set max fail counts\n            let coverNo;\n            while (remailFailCounts > 0) {\n                // rand one\n                coverNo = Math.floor(Math.random() * randomAmount + 1);\n                if (!usedCovers[coverNo]) {\n                    // valid\n                    break;\n                } else {\n                    // fails\n                    remailFailCounts--;\n                }\n            }\n\n            if (remailFailCounts <= 0) {\n                // rand failed, find one manually\n                coverNo = -1;\n                for (let i = 1; i <= randomAmount; i++) {\n                    if (!usedCovers[i]) {\n                        // use first\n                        coverNo = i;\n                        break;\n                    }\n                }\n                if (coverNo === -1) {\n                    // All used\n                    // clear all\n                    for (let i = 1; i <= randomAmount; i++) {\n                        usedCovers[i] = false;\n                    }\n                    // rand one\n                    coverNo = Math.floor(Math.random() * randomAmount + 1);\n                }\n            }\n\n            // mark as used\n            usedCovers[coverNo] = true;\n            \n            // return\n            return coverNo;\n        }\n\n        for (let i = 0, len = imageboxs.length; i < len; i++) {\n            if (!($(imageboxs[i]).attr(\"src\"))) {\n                const coverNo = generateNewCoverID();\n                const coverFileName = coverFileNameTemplate.replace(\"{no}\", coverNo.toString());\n                let coverUrl;\n                if (coverFileName.includes(\"//\")) {\n                    coverUrl = coverFileName;\n                } else if (baseUrl.substring(baseUrl.length - 1) === \"/\") {\n                    coverUrl = baseUrl + coverFileName;\n                } else {\n                    coverUrl = baseUrl + '/' + coverFileName;\n                }\n                $(imageboxs[i]).attr(\"src\", coverUrl);\n            }\n        }\n    };\n\n    const initMathjax = ()=>{\n        if (typeof MathJax !== 'undefined') {\n            // 渲染Mathjax的初始化函数（用于处理ajax后的情况）\n            // 使用了同步处理的方式，可惜第一次加载页面时会双倍触发\n            // （MathJax载入时会自动初始化一次）\n            MathJax.Hub.Typeset();\n        }\n    };\n\n    const fancyboxInit = ()=>{\n          if (typeof $.fancybox !== 'undefined'){\n            $.fancybox.defaults.hash = false;\n            $('.kratos-hentry').each(function(i){\n                $(this).find('img').each(function(){\n                  if ($(this).parent().hasClass('fancybox') || $(this).parent().hasClass('qrcode') || $(this).parent().is('a')) return;\n                  const alt = this.alt;\n                  if (alt) $(this).after('<span class=\"caption\">' + alt + '</span>');\n                  $(this).wrap('<a rel=\"gallery\" href=\"' + this.src + '\" data-fancybox=\\\"gallery\\\" data-caption=\"' + alt + '\"></a>')\n                });\n            });\n            $('.fancybox').fancybox();\n          }\n    };\n\n    const tocNavInit = ()=>{\n        $(document).on(\"click\", 'a[class=toc-link]', function(){\n            $('html, body').animate({\n                scrollTop:$(decodeURI($(this).attr(\"href\"))).offset().top - 60\n            },500);\n            return false;\n        });\n    };\n\n    let copyrightString;\n    const setCopyright = ()=>{\n        copyrightString = `\n\n-------------------------\n${kr.copyrightNotice}\n作者：${document.querySelector(\"meta[name='author']\").getAttribute('content')}\n来源：${document.title}\n链接：${window.location.href}\n`;\n    }\n\n    const copyEventInit = ()=>{\n        if (kr.copyrightNotice) {\n            document.body.oncopy = (e)=>{\n                const copiedContent = window.getSelection().toString();\n                if (copiedContent.length > 150) {\n                    e.preventDefault();\n                    if (e.clipboardData) {\n                        e.clipboardData.setData(\"text/plain\", copiedContent + copyrightString);\n                    }\n                }\n            };\n        }\n    };\n\n    let docTitle = '';\n    const saveTitle = () => {\n        docTitle = document.title;\n    };\n\n    const leaveEventInit = () => {\n        if (kr.siteLeaveEvent) {\n            let titleTime;\n            const OriginLogo = $('[rel=\"icon\"]').attr(\"href\");\n            document.addEventListener('visibilitychange', ()=>{\n                if (document.hidden) {\n                    document.title = kr.leaveTitle;\n                    if (kr.leaveLogo) {\n                        $('[rel=\"icon\"]').attr(\"href\", kr.leaveLogo);\n                    }\n                    clearTimeout(titleTime);\n                } else {\n                    document.title = kr.returnTitle + \" \" + docTitle;\n                    if (kr.leaveLogo) {\n                        $('[rel=\"icon\"]').attr(\"href\", OriginLogo);\n                    }\n                    titleTime = setTimeout(()=>{\n                        document.title = docTitle;\n                        titleTime = 0;\n                    }, 2000);\n                }\n            });\n        }\n    };\n\n    const getTimeString = (msec, exact = true) => {\n        let tString;\n        const sec = msec / 1000;\n        const dnum = Math.floor(sec / 60 / 60 / 24);\n        const hnum = Math.floor(sec / 60 / 60 - (24 * dnum));\n        const mnum = Math.floor(sec / 60 - (24 * 60 * dnum) - (60 * hnum));\n        const snum = Math.floor(sec - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum));\n        let dstr = dnum.toString();\n        let hstr = hnum.toString();\n        let mstr = mnum.toString();\n        let sstr = snum.toString();\n        if (exact) {\n            if (dstr && dstr.length === 1) {\n                dstr = '0' + dstr;\n            }\n            if (hstr && hstr.length === 1) {\n                hstr = '0' + hstr;\n            }\n            if (mstr && mstr.length === 1) {\n                mstr = '0' + mstr;\n            }\n            if (sstr && sstr.length === 1) {\n                sstr = '0' + sstr;\n            }\n            tString = dstr + \"天\" + hstr + \"小时\" + mstr + \"分\" + sstr + \"秒\";\n        } else {\n            // 大概值\n            if (dnum < 540) {\n                // 一年半内\n                if (dnum < 60) {\n                    // 两个月内\n                    tString = dstr + \"天\";\n                } else {\n                    // 年内月外\n                    tString = Math.floor(dnum / 30).toString() + '个月';\n                }\n            } else {\n                // 年外\n                tString = Math.floor(dnum / 365).toString() + '年';\n            }\n        }\n        return tString;\n    };\n\n    const initTime = () => {\n        const createTime = new Date(kr.createTime);\n        const upTimeNode = document.getElementById(\"span_dt\");\n        setInterval(() => {\n            upTimeNode.innerText = getTimeString(Date.now() - createTime);\n        }, 1000);\n    };\n\n    const codeCopyInit = () => {\n        // 使用了clipboard.js，所以非常的简洁，只需在前端生成对应的按钮和指定代码框的ID即可\n        const codeFigures = document.querySelectorAll('figure.highlight');\n        codeFigures.forEach((figure, count) => {\n            figure\n                .getElementsByTagName('table')[0]\n                .getElementsByTagName('tbody')[0]\n                .getElementsByTagName('tr')[0]\n                .getElementsByClassName('code')[0]\n            .setAttribute('id', `code-${count}`);\n\n            figure.innerHTML += \n            `<button class=\"copy\" data-clipboard-target=\"#code-${count}\">\n                <i class=\"fa fa-copy\"></i>&nbsp;复制\n            </button>`;\n        });\n\n        const clipboard = new ClipboardJS('button.copy');\n\n        clipboard.on('success', (e) => {\n            const origInner = e.trigger.innerHTML;\n            e.trigger.innerHTML = `<i class=\"fa fa-check-circle\"></i>&nbsp;成功~`;\n            setTimeout(() => {\n                e.trigger.innerHTML = origInner;\n            }, 3000);\n\n            e.clearSelection();\n        });\n    };\n\n    const commentsLazyLoad = () => {\n        // 检查当前是否在浏览器中运行\n        const runningOnBrowser = typeof window !== \"undefined\";\n        // 通过检查 scroll 事件 API 和 User-Agent 来匹配爬虫\n        const isBot = runningOnBrowser && !(\"onscroll\" in window) || typeof navigator !== \"undefined\" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);\n        // 检查当前浏览器是否支持 IntersectionObserver API\n        const supportsIntersectionObserver = runningOnBrowser && \"IntersectionObserver\" in window;\n        // 需要懒加载的评论区块\n        const commsArea = document.querySelector('.post-comments.lazy-load');\n        // 加载评论的函数\n        const loadwork = () => {\n            if (window.loadCommentsEventHandler) {\n                // 取消上一个加载事件\n                window.cancelIdleCallback(window.loadCommentsEventHandler);\n            }\n            // 加载新评论模块\n            window.loadCommentsEventHandler = window.requestIdleCallback(load_comm);\n            // 防止二次加载，清理掉函数\n            load_comm = null;\n        };\n        if (runningOnBrowser && !isBot && supportsIntersectionObserver && commsArea !== null) {\n            const observer = new IntersectionObserver((entries) => {\n                if (entries[0].isIntersecting) {\n                    loadwork();\n                    observer.disconnect();\n                }\n            }, { threshold: 0 });\n            observer.observe(commsArea);\n        } else if (typeof load_comm !== 'undefined' && load_comm !== null) {\n            // 直接加载\n            loadwork();\n        }\n    };\n\n    const expireNotify = () => {\n        if (kr.expire_day) {\n            const expireAlert = document.getElementById('expire-alert');\n            if (expireAlert) {\n                const dateTimeTag = expireAlert.querySelector('time');\n                const updateDateTime = new Date(parseInt(dateTimeTag.getAttribute('datetime')));\n                const nowDateTime = Date.now();\n                const gap = nowDateTime - updateDateTime;\n                if (gap > kr.expire_day * 24 * 3600 * 1000) {\n                    // 内容可能过期，需要提示\n                    dateTimeTag.innerText = getTimeString(gap, false);\n                    expireAlert.classList.remove('hidden');\n                }\n            }\n            \n        }\n    };\n\n    const makeDelay = (callback, ms) => {\n        var timer = 0;\n        return function () {\n            var context = this, args = arguments;\n            clearTimeout(timer);\n            timer = setTimeout(function () {\n                callback.apply(context, args);\n            }, ms || 0);\n        };\n    }\n\n    const tocAnimInit = () => {\n        if (document.getElementById('krw-toc') !== null) {\n            // 有toc的页面\n            // 获取侧边栏所有的toc项\n            const tocDOMs = document.getElementById(\"krw-toc\").getElementsByClassName('toc-item');\n            // 元素高度映射记录\n            const tocItems = [];\n            try {\n                Array.from(tocDOMs).forEach((tocItem) => {\n                    const linkItem = tocItem.querySelector('.toc-link');\n                    const titleText = decodeURI(linkItem.getAttribute('href'));\n                    if (titleText.substring(0, 1) != '#') {\n                        throw new Error('TOC 小标题链接无效，格式无限');\n                    }\n                    const titleElem = document.getElementById(titleText.substring(1));\n                    if (!titleElem) {\n                        throw new Error('TOC 小标题链接无效，未找到相关引用');\n                    }\n                    titleElem.setAttribute(\"data-toc-id\", tocItems.length)\n                    tocItems.push({\n                        at: titleElem,\n                        el: tocItem\n                    });\n                });\n            } catch (e) {\n                console.log('错误：', e.message);\n                Array.from(tocDOMs).forEach((tocItem) => {\n                    tocItem.classList.add('show');\n                });\n                return;\n            }\n\n            // 初始化为不存在的标题\n            let curTocId = -1;\n            // 标题激活状态修改函数\n            const tocActivate = (newId) => {\n                if (curTocId === newId) {\n                    // Do nothing...\n                    return;\n                }\n                if (curTocId !== -1) {\n                    // 清除旧标题激活状态\n                    tocItems[curTocId].el.classList.remove('active');\n                    tocItems[curTocId].el.classList.remove('show');\n                    // 清除旧元素层级展示状态\n                    let nCur = tocItems[curTocId].el\n                    while (!nCur.classList.contains('toc')) {\n                        if (nCur.classList.contains('toc-item')) {\n                            nCur.classList.remove('show');\n                        }\n                        nCur = nCur.parentNode;\n                    }\n                }\n                if (newId !== -1) {\n                    // 构建新标题激活状态\n                    tocItems[newId].el.classList.add('active');\n                    tocItems[newId].el.classList.add('show');\n                    // 建立新元素层级展示状态\n                    let nCur = tocItems[newId].el\n                    while (!nCur.classList.contains('toc')) {\n                        if (nCur.classList.contains('toc-item')) {\n                            nCur.classList.add('show');\n                        }\n                        nCur = nCur.parentNode;\n                    }\n                }\n                curTocId = newId;\n            };\n\n            if (\"IntersectionObserver\" in window) {\n                const applyDecision = makeDelay((i, pos) => {\n                    if (pos === window.scrollY) {\n                        window.requestAnimationFrame(() => {\n                            tocActivate(i);\n                        });\n                    } else {\n                        applyDecision(i, window.scrollY);\n                    }\n                }, 100)\n\n                const observer = new IntersectionObserver((entries) => {\n                    let decision = null\n                    entries.forEach((entry) => {\n                        const currentIndex = Number.parseInt(entry.target.getAttribute('data-toc-id'), 10);\n                        if (!entry.isIntersecting\n                            && entry.boundingClientRect.top <= entry.rootBounds.top) {\n                            decision = currentIndex\n                        } else if (entry.isIntersecting\n                            && entry.boundingClientRect.bottom < entry.rootBounds.top + entry.rootBounds.height / 2\n                            && entry.intersectionRatio === 1) {\n                            decision = currentIndex - 1\n                        }\n                    })\n                    if (decision !== null) {\n                        applyDecision(decision, window.scrollY);\n                    }\n                }, {\n                    rootMargin: '-62px 0px 0px 0px',\n                    threshold: 1.0,\n                })\n                tocItems.forEach((x) => {\n                    observer.observe(x.at)\n                });\n                window.addEventListener('pjax:before', () => {\n                    observer.disconnect();\n                    tocItems.length = 0; // 奇妙的数组清空方式\n                }, { once: true });\n            } else {\n                const tocUpdatePos = () => {\n                    tocItems.forEach((x) => {\n                        x.h = x.at.getBoundingClientRect().top + window.scrollY - 61 // 比 click 事件那里多减掉1，避免浏览器 round 后导致的判断失败\n                    });\n                };\n\n                tocUpdatePos();\n\n                // 标题定位函数\n                const tocGetId = () => {\n                    let newPos;\n                    if (!Number.isInteger(curTocId) || curTocId < 0 || curTocId > tocItems.length - 1) {\n                        newPos = 0;\n                    } else {\n                        newPos = curTocId;\n                    }\n                    const nowY = window.scrollY;\n                    if (nowY >= tocItems[newPos].h) {\n                        if (nowY >= tocItems[tocItems.length - 1].h) {\n                            newPos = tocItems.length - 1;\n                        } else {\n                            while (nowY >= tocItems[newPos + 1].h) {\n                                newPos++;\n                            }\n                        }\n                    } else {\n                        while (nowY < tocItems[newPos].h) {\n                            newPos--;\n                            if (newPos < 0) break;\n                        }\n                    }\n                    return newPos;\n                }\n\n                // 处理事件的函数\n                const tocOnScroll = makeDelay(() => {\n                    window.requestAnimationFrame(() => {\n                        tocActivate(tocGetId());\n                    });\n                }, 100);\n\n                const tocOnResize = makeDelay(() => {\n                    tocUpdatePos();\n                    window.requestAnimationFrame(() => {\n                        tocActivate(tocGetId());\n                    });\n                }, 100);\n\n                window.addEventListener(\"resize\", tocOnResize);\n                window.addEventListener('scroll', tocOnScroll);\n                // pjax前销毁\n                window.addEventListener('pjax:before', () => {\n                    window.removeEventListener('resize', tocOnResize);\n                    window.removeEventListener('scroll', tocOnScroll);\n                    tocItems.length = 0; // 奇妙的数组清空方式\n                }, { once: true });\n            }\n\n            // 阅读进度\n            const readProgBar = document.getElementsByClassName('toc-progress-bar')[0];\n            const articleElem = document.querySelector('.kratos-post-content');\n            const setPercent = () => {\n                // 参考 Butterfly 主题相关实现\n                // https://github.com/jerryc127/hexo-theme-butterfly/blob/c1ac4a5e167f7bb26287fc9ca32a182cfc293231/source/js/main.js#L337-L346\n                if (articleElem) {\n                    const currentTop = window.scrollY || document.documentElement.scrollTop\n                    const docHeight = articleElem.clientHeight\n                    const winHeight = document.documentElement.clientHeight\n                    const headerHeight = articleElem.offsetTop\n                    const contentMath =\n                        (docHeight > winHeight) ?\n                            (docHeight - winHeight) :\n                            (document.documentElement.scrollHeight - winHeight)\n                    const scrollPercent = Math.max(0, Math.min((currentTop - headerHeight) / (contentMath), 1))\n                    const scrollPercentRound = Math.round(scrollPercent * 100)\n                    readProgBar.style.width = (scrollPercent * 100).toString() + '%';\n                    readProgBar.setAttribute('aria-valuenow', scrollPercentRound);\n                }\n            }\n            window.addEventListener('scroll', () => {\n                window.requestAnimationFrame(setPercent);\n            });\n            setPercent(); // 初始运行一次\n        }\n    };\n\n    const topNavScrollToggleInit = () => {\n        // 判断设置参数\n        if (!kr.topNavScrollToggle) {\n            return; // 没有启用\n        }\n        // 记录上一次滚动高度，用于判断滚动方向\n        let lastHeight = window.innerHeight;\n        // 记录顶部栏隐藏状态\n        let isTopNavHidden = false;\n\n        // 处理事件的函数\n        const handleTopNavScrollToggle = () => {\n            window.requestAnimationFrame(() => {\n                if (lastHeight < window.scrollY) {\n                    // 向下滚动\n                    if (!isTopNavHidden) {\n                        document.body.classList.add('nav-up');\n                        isTopNavHidden = true;\n                    }\n                } else if (lastHeight > window.scrollY) {\n                    // 向上滚动\n                    if (isTopNavHidden) {\n                        document.body.classList.remove('nav-up');\n                        isTopNavHidden = false;\n                    }\n                }\n                // 相等则不做处理\n                lastHeight = window.scrollY;\n            });\n        };\n\n        // 仅处理鼠标滚动\n        window.addEventListener('wheel', handleTopNavScrollToggle);\n\n    };\n\n    const pjaxReload = () => {\n        loadRandomCover();\n        fancyboxInit();\n        setCopyright();\n        saveTitle();\n        initMathjax();\n        codeCopyInit();\n        commentsLazyLoad();\n        expireNotify();\n        tocAnimInit();\n    };\n\n    const funcUsingConfig = () => {\n        // 因为涉及到配置文件，所以这些是只有在完成配置加载后才能调用的函数\n        pjaxReload();\n\n        copyEventInit();\n        leaveEventInit();\n        initTime();\n        donateConfig();\n        topNavScrollToggleInit();\n    };\n\n    window.addEventListener('pjax:complete', pjaxReload);\n\n    window.addEventListener('window:onload', () => {\n        loadConfig(funcUsingConfig);\n        pageScrollDownInit();\n        offcanvas();\n        mobiClick();\n        xControl();\n        shareMenu();\n        tocNavInit();\n    }, { once: true });\n\n    window.onload = () => {\n        window.dispatchEvent(new Event('window:onload'));\n        console.log('页面加载完毕！消耗了 %c'+Math.round(performance.now()*100)/100+' ms','background:#282c34;color:#51aded;');\n    };\n\n})();\n"]}